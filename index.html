<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
      <meta name="theme-color" content="#1a1a2e">
      <title>AI Fitness Tracker</title>
    <link rel="manifest" href="manifest.json">
    <style>
          * {
                  margin: 0;
                  padding: 0;
                  box-sizing: border-box;
                  -webkit-tap-highlight-color: transparent;
          }

          :root {
                  --bg-primary: #0f0f1e;
                  --bg-secondary: #1a1a2e;
                  --bg-tertiary: #252541;
                  --accent: #00d9ff;
                  --accent-hover: #00b8d9;
                  --text-primary: #ffffff;
                  --text-secondary: #a0a0b8;
                  --success: #00ff88;
                  --warning: #ffaa00;
                  --danger: #ff4444;
          }

          body {
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                  background: var(--bg-primary);
                  color: var(--text-primary);
                  overflow-x: hidden;
                  padding-bottom: 80px;
          }

          .header {
                  background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
                  padding: 20px;
                  position: sticky;
                  top: 0;
                  z-index: 100;
                  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
          }

          .header h1 {
                  font-size: 24px;
                  font-weight: 700;
                  background: linear-gradient(135deg, var(--accent) 0%, #00ff88 100%);
                  -webkit-background-clip: text;
                  -webkit-text-fill-color: transparent;
                  background-clip: text;
          }

          .header p {
                  color: var(--text-secondary);
                  font-size: 14px;
                  margin-top: 4px;
          }

          .nav {
                  position: fixed;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  background: var(--bg-secondary);
                  display: flex;
                  justify-content: space-around;
                  padding: 12px 0 20px;
                  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
                  z-index: 100;
          }

          .nav-item {
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  gap: 4px;
                  color: var(--text-secondary);
                  font-size: 12px;
                  cursor: pointer;
                  transition: all 0.3s;
                  padding: 8px 16px;
                  border-radius: 12px;
          }

          .nav-item.active {
                  color: var(--accent);
                  background: rgba(0, 217, 255, 0.1);
          }

          .nav-icon {
                  font-size: 24px;
          }

          .container {
                  padding: 20px;
                  max-width: 600px;
                  margin: 0 auto;
          }

          .screen {
                  display: none;
          }

          .screen.active {
                  display: block;
          }

          .btn {
                  background: linear-gradient(135deg, var(--accent) 0%, #00b8d9 100%);
                  color: white;
                  border: none;
                  padding: 16px 24px;
                  border-radius: 12px;
                  font-size: 16px;
                  font-weight: 600;
                  cursor: pointer;
                  width: 100%;
                  margin-top: 12px;
                  transition: all 0.3s;
                  box-shadow: 0 4px 12px rgba(0, 217, 255, 0.3);
          }

          .btn:active {
                  transform: scale(0.98);
          }

          .btn-secondary {
                  background: var(--bg-tertiary);
                  box-shadow: none;
          }

          .btn-danger {
                  background: linear-gradient(135deg, var(--danger) 0%, #cc0000 100%);
                  box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
          }

          .card {
                  background: var(--bg-secondary);
                  border-radius: 16px;
                  padding: 20px;
                  margin-bottom: 16px;
                  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          }

          .card h3 {
                  font-size: 18px;
                  margin-bottom: 12px;
                  color: var(--accent);
          }

          .form-group {
                  margin-bottom: 20px;
          }

          .form-group label {
                  display: block;
                  margin-bottom: 8px;
                  color: var(--text-secondary);
                  font-size: 14px;
                  font-weight: 500;
          }

          .form-group input, .form-group select, .form-group textarea {
                  width: 100%;
                  padding: 14px;
                  background: var(--bg-tertiary);
                  border: 2px solid transparent;
                  border-radius: 12px;
                  color: var(--text-primary);
                  font-size: 16px;
                  transition: all 0.3s;
          }

          .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
                  outline: none;
                  border-color: var(--accent);
          }

          .exercise-item {
                  background: var(--bg-tertiary);
                  border-radius: 12px;
                  padding: 16px;
                  margin-bottom: 12px;
          }

          .exercise-header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 12px;
          }

          .exercise-name {
                  font-size: 16px;
                  font-weight: 600;
          }

          .exercise-target {
                  font-size: 12px;
                  color: var(--text-secondary);
          }

          .set-logger {
                  display: grid;
                  grid-template-columns: 1fr 1fr auto;
                  gap: 8px;
                  margin-bottom: 8px;
          }

          .set-input {
                  padding: 12px;
                  background: var(--bg-primary);
                  border: 2px solid var(--bg-tertiary);
                  border-radius: 8px;
                  color: var(--text-primary);
                  text-align: center;
                  font-size: 16px;
          }

          .check-btn {
                  background: var(--success);
                  border: none;
                  border-radius: 8px;
                  color: var(--bg-primary);
                  font-size: 20px;
                  cursor: pointer;
                  padding: 0 16px;
          }

          .check-btn.checked {
                  background: var(--bg-tertiary);
                  color: var(--success);
          }

          .timer {
                  background: var(--bg-secondary);
                  border-radius: 16px;
                  padding: 32px;
                  text-align: center;
                  margin-bottom: 20px;
          }

          .timer-display {
                  font-size: 64px;
                  font-weight: 700;
                  color: var(--accent);
                  margin: 20px 0;
          }

          .timer-controls {
                  display: flex;
                  gap: 12px;
                  justify-content: center;
          }

          .timer-btn {
                  padding: 12px 24px;
                  background: var(--bg-tertiary);
                  border: none;
                  border-radius: 12px;
                  color: var(--text-primary);
                  font-size: 16px;
                  cursor: pointer;
          }

          .stats-grid {
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 12px;
                  margin-bottom: 20px;
          }

          .stat-card {
                  background: var(--bg-secondary);
                  border-radius: 12px;
                  padding: 16px;
                  text-align: center;
          }

          .stat-value {
                  font-size: 28px;
                  font-weight: 700;
                  color: var(--accent);
          }

          .stat-label {
                  font-size: 12px;
                  color: var(--text-secondary);
                  margin-top: 4px;
          }

          .spinner {
                  border: 3px solid var(--bg-tertiary);
                  border-top: 3px solid var(--accent);
                  border-radius: 50%;
                  width: 40px;
                  height: 40px;
                  animation: spin 1s linear infinite;
                  margin: 0 auto 16px;
          }

          @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
          }

          .workout-list {
                  display: flex;
                  flex-direction: column;
                  gap: 12px;
          }

          .workout-card {
                  background: var(--bg-secondary);
                  border-radius: 12px;
                  padding: 16px;
                  cursor: pointer;
                  transition: all 0.3s;
                  border: 2px solid transparent;
          }

          .workout-card:active {
                  transform: scale(0.98);
                  border-color: var(--accent);
          }

          .workout-title {
                  font-size: 16px;
                  font-weight: 600;
                  margin-bottom: 8px;
          }

          .workout-meta {
                  font-size: 14px;
                  color: var(--text-secondary);
          }

          .ai-message {
                  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 255, 136, 0.1) 100%);
                  border-left: 4px solid var(--accent);
                  border-radius: 12px;
                  padding: 16px;
                  margin: 16px 0;
          }

          .ai-message-header {
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  margin-bottom: 8px;
                  color: var(--accent);
                  font-weight: 600;
          }

          .hidden {
                  display: none !important;
          }

          .empty-state {
                  text-align: center;
                  padding: 60px 20px;
          }

          .empty-state-icon {
                  font-size: 64px;
                  margin-bottom: 16px;
                  opacity: 0.5;
          }

          .empty-state-text {
                  color: var(--text-secondary);
                  font-size: 16px;
          }
        </style>
  </head>
  <body>
      <div class="header">
            <h1>AI Fitness Tracker</h1>
          <p id="header-subtitle">Your intelligent workout companion</p>p>
      </div>div>
  
    <div id="onboarding-screen" class="screen active">
        <div class="container">
              <div class="card">
                      <h3>üéØ Let's Build Your Perfect Split</h3>
                      <p style="color: var(--text-secondary); margin-bottom: 20px;">
                        I'll create a personalized workout program tailored to your goals, experience, and schedule.
                      </p>p>
                      <div class="form-group">
                                <label>What's your primary goal?</label>
                                <select id="goal">
                                            <option value="muscle_gain">Build Muscle</option>option>
                                            <option value="strength">Get Stronger</option>option>
                                            <option value="fat_loss">Lose Fat</option>option>
                                            <option value="athletic">Athletic Performance</option>option>
                                            <option value="general">General Fitness</option>option>
                                </select>select>
                      </div>div>
                      <div class="form-group">
                                <label>Training experience?</label>
                                <select id="experience">
                                            <option value="beginner">Beginner (0-1 years)</option>option>
                                            <option value="intermediate">Intermediate (1-3 years)</option>option>
                                            <option value="advanced">Advanced (3+ years)</option>option>
                                </select>select>
                      </div>div>
                      <div class="form-group">
                                <label>Days per week you can train?</label>
                                <select id="days">
                                            <option value="3">3 days</option>option>
                                            <option value="4">4 days</option>option>
                                            <option value="5">5 days</option>option>
                                            <option value="6">6 days</option>option>
                                </select>select>
                      </div>div>
                      <div class="form-group">
                                <label>Available equipment?</label>
                                <select id="equipment">
                                            <option value="full_gym">Full Gym</option>option>
                                            <option value="home_basic">Home (Dumbbells/Bands)</option>option>
                                            <option value="minimal">Minimal/Bodyweight</option>option>
                                </select>select>
                      </div>div>
                      <div class="form-group">
                                <label>Any injuries or limitations? (optional)</label>
                                <textarea id="limitations" rows="3" placeholder="e.g., lower back issues, shoulder pain"></textarea>
                      </div>div>
                      <button class="btn" onclick="generateSplit()">Generate My Split ‚ú®</button>button>
              </div>div>
        </div>div>
    </div>div>
  
    <div id="home-screen" class="screen">
        <div class="container">
              <div id="todays-workout"></div>div>
        </div>div>
    </div>div>
  
    <div id="workout-screen" class="screen">
        <div class="container">
              <div class="card">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3 id="workout-title">Workout</h3>
                                <button class="btn-secondary" style="padding: 8px 16px; width: auto;" onclick="finishWorkout()">Finish</button>button>
                      </div>div>
                      <div class="timer hidden" id="rest-timer">
                                <div style="font-size: 14px; color: var(--text-secondary);">Rest Time</div>div>
                                <div class="timer-display" id="timer-display">01:30</div>div>
                                <div class="timer-controls">
                                            <button class="timer-btn" onclick="skipRest()">Skip</button>button>
                                            <button class="timer-btn" onclick="addTime(30)">+30s</button>button>
                                </div>div>
                      </div>div>
                      <div id="exercise-list"></div>div>
                      <div class="ai-message hidden" id="ai-suggestion">
                                <div class="ai-message-header">ü§ñ AI Coach</div>div>
                                <div id="ai-suggestion-text"></div>div>
                      </div>div>
              </div>div>
        </div>div>
    </div>div>
  
    <div id="progress-screen" class="screen">
        <div class="container">
              <div class="stats-grid">
                      <div class="stat-card">
                                <div class="stat-value" id="total-workouts">0</div>div>
                                <div class="stat-label">Total Workouts</div>div>
                      </div>div>
                      <div class="stat-card">
                                <div class="stat-value" id="total-volume">0</div>div>
                                <div class="stat-label">Total Volume (lbs)</div>div>
                      </div>div>
              </div>div>
              <div class="card">
                      <h3>Recent Workouts</h3>
                      <div id="workout-history">
                                <div class="empty-state">
                                            <div class="empty-state-icon">üìä</div>div>
                                            <div class="empty-state-text">Complete your first workout to see progress</div>div>
                                </div>div>
                      </div>div>
              </div>div>
              <div class="card">
                      <h3>Personal Records</h3>
                      <div id="personal-records">
                                <div class="empty-state">
                                            <div class="empty-state-icon">üèÜ</div>div>
                                            <div class="empty-state-text">PRs will appear here as you train</div>div>
                                </div>div>
                      </div>div>
              </div>div>
        </div>div>
    </div>div>
  
    <div id="settings-screen" class="screen">
        <div class="container">
              <div class="card">
                      <h3>Your Program</h3>
                      <p style="color: var(--text-secondary); margin-bottom: 16px;" id="program-description">
                        View and modify your current training split.
                      </p>p>
                      <button class="btn-secondary" onclick="showOnboarding()">Regenerate Split</button>button>
              </div>div>
              <div class="card">
                      <h3>Data Management</h3>
                      <button class="btn-secondary" onclick="exportData()">Export All Data</button>button>
                      <button class="btn-danger" onclick="resetApp()">Reset Everything</button>button>
              </div>div>
              <div class="card">
                      <h3>About</h3>
                      <p style="color: var(--text-secondary); font-size: 14px;">
                        AI Fitness Tracker v1.0<br>
                        Powered by Claude AI<br><br>
                        <strong>‚ö†Ô∏è Disclaimer:</strong> This app is not a replacement for professional medical or fitness advice. Consult with a healthcare provider before starting any exercise program.
                      </p>p>
              </div>div>
        </div>div>
    </div>div>
  
    <div class="nav">
        <div class="nav-item active" onclick="showScreen('home')">
              <div class="nav-icon">üè†</div>div>
              <div>Home</div>
        </div>
        <div class="nav-item" onclick="showScreen('progress')">
                <div class="nav-icon">üìä</div>
                <div>Progress</div>
        </div>
        <div class="nav-item" onclick="showScreen('settings')">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div>Settings</div>
        </div>
    </div>

      <script>
            const STORAGE_KEYS = {
                    USER_PROFILE: 'fitness_user_profile',
                    WORKOUT_SPLIT: 'fitness_workout_split',
                    WORKOUT_HISTORY: 'fitness_workout_history',
                    CURRENT_WORKOUT: 'fitness_current_workout',
                    PERSONAL_RECORDS: 'fitness_personal_records'
            };

            let currentWorkout = null;
            let restTimerInterval = null;
            let restTimeRemaining = 90;

            window.addEventListener('DOMContentLoaded', () => {
                    const userProfile = getStorage(STORAGE_KEYS.USER_PROFILE);
                    if (userProfile) {
                              showScreen('home');
                              loadHomeScreen();
                    }
            });

            function getStorage(key) {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
            }

            function setStorage(key, value) {
                    localStorage.setItem(key, JSON.stringify(value));
        }

            async function generateSplit() {
                    const goal = document.getElementById('goal').value;
                    const experience = document.getElementById('experience').value;
                    const days = document.getElementById('days').value;
                    const equipment = document.getElementById('equipment').value;
                    const limitations = document.getElementById('limitations').value;

                    const userProfile = { goal, experience, days, equipment, limitations };
                    setStorage(STORAGE_KEYS.USER_PROFILE, userProfile);

                    const btn = event.target;
                    btn.innerHTML = '<div class="spinner"></div>';
                    btn.disabled = true;

                    const prompt = `Create a ${days}-day workout split for someone with the following profile:
                    - Goal: ${goal}
                    - Experience: ${experience}
                    - Equipment: ${equipment}
                    ${limitations ? `- Limitations: ${limitations}` : ''}

                    Return a JSON object with this structure:
                    {
                      "split_name": "descriptive name",
                        "description": "brief explanation",
                          "workouts": [
                              {
                                    "day": "Day 1",
                                          "focus": "e.g., Push",
                                                "exercises": [
                                                        {
                                                                  "name": "Exercise",
                                                                            "sets": 3,
                                                                                      "reps": "8-10",
                                                                                                "rest_seconds": 90,
                                                                                                          "notes": "form cues"
                                                                                                                  }
                                                                                                                        ]
                                                                                                                            }
                                                                                                                              ]
                                                                                                                              }`;

                    try {
                              const response = await fetch('https://api.anthropic.com/v1/messages', {
                                          method: 'POST',
                                          headers: {
                                                        'Content-Type': 'application/json',
                                                        'anthropic-version': '2023-06-01'
                                          },
                                          body: JSON.stringify({
                                                        model: 'claude-sonnet-4-20250514',
                                                        max_tokens: 4000,
                                                        messages: [{ role: 'user', content: prompt }]
                                          })
                              });
                              const data = await response.json();
                              const splitText = data.content[0].text;
                              const jsonMatch = splitText.match(/\{[\s\S]*\}/);
                              const workoutSplit = JSON.parse(jsonMatch[0]);
                              setStorage(STORAGE_KEYS.WORKOUT_SPLIT, workoutSplit);
                              showScreen('home');
                              loadHomeScreen();
                    } catch (error) {
                              alert('Error generating split. Using sample workout.');
                              const sampleSplit = createSampleSplit(days, goal);
                              setStorage(STORAGE_KEYS.WORKOUT_SPLIT, sampleSplit);
                              showScreen('home');
                              loadHomeScreen();
                    }
            }

            function createSampleSplit(days, goal) {
                    const workouts = [];
                    const splits = {
                              '3': ['Push', 'Pull', 'Legs'],
                              '4': ['Upper Power', 'Lower Power', 'Upper Hypertrophy', 'Lower Hypertrophy'],
                              '5': ['Push', 'Pull', 'Legs', 'Upper', 'Lower'],
                              '6': ['Push', 'Pull', 'Legs', 'Push', 'Pull', 'Legs']
                    };
                    const exercises = {
                              'Push': [
                                { name: 'Bench Press', sets: 4, reps: '6-8', rest_seconds: 120, notes: 'Control descent' },
                                { name: 'Overhead Press', sets: 3, reps: '8-10', rest_seconds: 90, notes: 'Keep core tight' },
                                { name: 'Incline Dumbbell Press', sets: 3, reps: '10-12', rest_seconds: 60, notes: 'Squeeze at top' }
                                        ],
                              'Pull': [
                                { name: 'Deadlift', sets: 4, reps: '5-6', rest_seconds: 180, notes: 'Neutral spine' },
                                { name: 'Pull-ups', sets: 3, reps: '8-10', rest_seconds: 90, notes: 'Full ROM' },
                                { name: 'Barbell Rows', sets: 3, reps: '8-10', rest_seconds: 90, notes: 'Pull to chest' }
                                        ],
                              'Legs': [
                                { name: 'Squat', sets: 4, reps: '6-8', rest_seconds: 150, notes: 'Below parallel' },
                                { name: 'Romanian Deadlift', sets: 3, reps: '8-10', rest_seconds: 90, notes: 'Hamstring stretch' },
                                { name: 'Leg Press', sets: 3, reps: '12-15', rest_seconds: 60, notes: 'Full range' }
                                        ],
                              'Upper': [
                                { name: 'Bench Press', sets: 3, reps: '8-10', rest_seconds: 90, notes: 'Control tempo' },
                                { name: 'Pull-ups', sets: 3, reps: '8-10', rest_seconds: 90, notes: 'Full ROM' }
                                        ],
                              'Lower': [
                                { name: 'Squat', sets: 4, reps: '8-10', rest_seconds: 120, notes: 'Controlled' },
                                { name: 'Romanian Deadlift', sets: 3, reps: '10-12', rest_seconds: 90, notes: 'Hinge hips' }
                                        ]
                    };

                    splits[days].forEach((focus, index) => {
                              workouts.push({
                                          day: `Day ${index + 1}`,
                                          focus: focus,
                                          exercises: exercises[focus] || exercises['Push']
                              });
                    });

                    return {
                              split_name: `${days}-Day Program`,
                              description: `Optimized ${days} day program`,
                              workouts: workouts
                    };
            }

            function loadHomeScreen() {
                    const split = getStorage(STORAGE_KEYS.WORKOUT_SPLIT);
                    const history = getStorage(STORAGE_KEYS.WORKOUT_HISTORY) || [];

                    if (!split) {
                              showOnboarding();
                              return;
                    }

                    let nextWorkoutIndex = 0;
                    if (history.length > 0) {
                              const lastWorkout = history[history.length - 1];
                              const lastIndex = split.workouts.findIndex(w => w.day === lastWorkout.day);
                              nextWorkoutIndex = (lastIndex + 1) % split.workouts.length;
                    }

                    const nextWorkout = split.workouts[nextWorkoutIndex];
                    const container = document.getElementById('todays-workout');

                    container.innerHTML = `
                            <div class="card">
                                      <h3>Today's Workout</h3>
                                                <div style="margin: 16px 0;">
                                                            <div style="font-size: 24px; font-weight: 700; color: var(--accent);">
                                                                          ${nextWorkout.day} - ${nextWorkout.focus}
                                                                                      </div>
                                                                                                  <div style="color: var(--text-secondary); margin-top: 8px;">
                                                                                                                ${nextWorkout.exercises.length} exercises
                                                                                                                            </div>
                                                                                                                                      </div>
                                                                                                                                                <button class="btn" onclick="startWorkout(${nextWorkoutIndex})">Start Workout üí™</button>
                                                                                                                                                        </div>
                                                                                                                                                                <div class="card">
                                                                                                                                                                          <h3>Your Program</h3>
                                                                                                                                                                                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                                                                                                                                                                                                ${split.description}
                                                                                                                                                                                                          </p>
                                                                                                                                                                                                                    <div class="workout-list">
                                                                                                                                                                                                                                ${split.workouts.map((w, i) => `
                                                                                                                                                                                                                                              <div class="workout-card" onclick="startWorkout(${i})">
                                                                                                                                                                                                                                                              <div class="workout-title">${w.day} - ${w.focus}</div>
                                                                                                                                                                                                                                                                              <div class="workout-meta">${w.exercises.length} exercises</div>
                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                        `).join('')}
                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                `;
                    updateProgressScreen();
            }

            function startWorkout(workoutIndex) {
                    const split = getStorage(STORAGE_KEYS.WORKOUT_SPLIT);
                    const workout = split.workouts[workoutIndex];
                    currentWorkout = {
                              ...workout,
                              startTime: new Date().toISOString(),
                              exercises: workout.exercises.map(ex => ({
                                          ...ex,
                                          sets_completed: []
                              }))
                    };
                    setStorage(STORAGE_KEYS.CURRENT_WORKOUT, currentWorkout);
                    showScreen('workout');
                    renderWorkout();
            }

            function renderWorkout() {
                    document.getElementById('workout-title').textContent = `${currentWorkout.day} - ${currentWorkout.focus}`;
                    const exerciseList = document.getElementById('exercise-list');
                    exerciseList.innerHTML = currentWorkout.exercises.map((exercise, exIndex) => `
                            <div class="exercise-item">
                                      <div class="exercise-header">
                                                  <div>
                                                                <div class="exercise-name">${exercise.name}</div>
                                                                              <div class="exercise-target">${exercise.sets} √ó ${exercise.reps} | Rest: ${exercise.rest_seconds}s</div>
                                                                                            ${exercise.notes ? `<div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">üí° ${exercise.notes}</div>` : ''}
                                                                                                        </div>
                                                                                                                  </div>
                                                                                                                            ${Array.from({ length: exercise.sets }, (_, setIndex) => {
                                                                                                                                          const completedSet = exercise.sets_completed[setIndex];
                                                                                                                                          return `
                                                                                                                                                        <div class="set-logger">
                                                                                                                                                                        <input type="number" class="set-input" placeholder="Weight" value="${completedSet ? completedSet.weight : ''}" id="weight-${exIndex}-${setIndex}">
                                                                                                                                                                                        <input type="number" class="set-input" placeholder="Reps" value="${completedSet ? completedSet.reps : ''}" id="reps-${exIndex}-${setIndex}">
                                                                                                                                                                                                        <button class="check-btn ${completedSet ? 'checked' : ''}" onclick="logSet(${exIndex}, ${setIndex})">‚úì</button>
                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                  `;
                                                                                                                              }).join('')}
                                                                                                                                      </div>
                                                                                                                                            `).join('');
            }

            function logSet(exIndex, setIndex) {
                    const weightInput = document.getElementById(`weight-${exIndex}-${setIndex}`);
                    const repsInput = document.getElementById(`reps-${exIndex}-${setIndex}`);
                    const weight = parseFloat(weightInput.value);
                    const reps = parseInt(repsInput.value);

                    if (!weight || !reps) {
                              alert('Please enter both weight and reps');
                              return;
                    }

                    currentWorkout.exercises[exIndex].sets_completed[setIndex] = { weight, reps };
                    setStorage(STORAGE_KEYS.CURRENT_WORKOUT, currentWorkout);
                    startRestTimer(currentWorkout.exercises[exIndex].rest_seconds);
                    renderWorkout();
            }

            function startRestTimer(seconds) {
                    restTimeRemaining = seconds;
                    document.getElementById('rest-timer').classList.remove('hidden');
                    updateTimerDisplay();
                    if (restTimerInterval) clearInterval(restTimerInterval);
                    restTimerInterval = setInterval(() => {
                              restTimeRemaining--;
                              updateTimerDisplay();
                              if (restTimeRemaining <= 0) skipRest();
                    }, 1000);
            }

            function updateTimerDisplay() {
                    const minutes = Math.floor(restTimeRemaining / 60);
                    const seconds = restTimeRemaining % 60;
                    document.getElementById('timer-display').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            function skipRest() {
                    if (restTimerInterval) clearInterval(restTimerInterval);
                    document.getElementById('rest-timer').classList.add('hidden');
            }

            function addTime(seconds) {
                    restTimeRemaining += seconds;
                    updateTimerDisplay();
            }

            function finishWorkout() {
                    if (!confirm('Finish this workout?')) return;
                    currentWorkout.endTime = new Date().toISOString();
                    let totalVolume = 0;
                    currentWorkout.exercises.forEach(ex => {
                              ex.sets_completed.forEach(set => {
                                          totalVolume += set.weight * set.reps;
                              });
                    });
                    currentWorkout.totalVolume = totalVolume;
                    const history = getStorage(STORAGE_KEYS.WORKOUT_HISTORY) || [];
                    history.push(currentWorkout);
                    setStorage(STORAGE_KEYS.WORKOUT_HISTORY, history);
                    updatePersonalRecords(currentWorkout);
                    localStorage.removeItem(STORAGE_KEYS.CURRENT_WORKOUT);
                    currentWorkout = null;
                    alert(`Workout complete! Total volume: ${totalVolume.toLocaleString()} lbs`);
                    showScreen('home');
                    loadHomeScreen();
            }

            function updatePersonalRecords(workout) {
                    const prs = getStorage(STORAGE_KEYS.PERSONAL_RECORDS) || {};
                    workout.exercises.forEach(ex => {
                              ex.sets_completed.forEach(set => {
                                          const key = ex.name;
                                          if (!prs[key] || set.weight > prs[key].weight) {
                                                        prs[key] = { weight: set.weight, reps: set.reps, date: workout.endTime };
                                          }
                              });
                    });
                    setStorage(STORAGE_KEYS.PERSONAL_RECORDS, prs);
            }

            function updateProgressScreen() {
                    const history = getStorage(STORAGE_KEYS.WORKOUT_HISTORY) || [];
                    const prs = getStorage(STORAGE_KEYS.PERSONAL_RECORDS) || {};
                    document.getElementById('total-workouts').textContent = history.length;
                    const totalVolume = history.reduce((sum, w) => sum + (w.totalVolume || 0), 0);
                    document.getElementById('total-volume').textContent = totalVolume.toLocaleString();

                    const historyContainer = document.getElementById('workout-history');
                    if (history.length === 0) {
                              historyContainer.innerHTML = `
                                        <div class="empty-state">
                                                    <div class="empty-state-icon">üìä</div>
                                                                <div class="empty-state-text">Complete your first workout to see progress</div>
                                                                          </div>
                                                                                  `;
                    } else {
                              historyContainer.innerHTML = history.slice(-10).reverse().map(w => `
                                        <div class="workout-card">
                                                    <div class="workout-title">${w.day} - ${w.focus}</div>
                                                                <div class="workout-meta">
                                                                              ${new Date(w.endTime).toLocaleDateString()} | ${w.totalVolume?.toLocaleString() || 0} lbs
                                                                                          </div>
                                                                                                    </div>
                                                                                                            `).join('');
                    }

                    const prContainer = document.getElementById('personal-records');
                    const prEntries = Object.entries(prs);
                    if (prEntries.length === 0) {
                              prContainer.innerHTML = `
                                        <div class="empty-state">
                                                    <div class="empty-state-icon">üèÜ</div>
                                                                <div class="empty-state-text">PRs will appear here as you train</div>
                                                                          </div>
                                                                                  `;
                    } else {
                              prContainer.innerHTML = prEntries.map(([exercise, record]) => `
                                        <div class="workout-card">
                                                    <div class="workout-title">${exercise}</div>
                                                                <div class="workout-meta">
                                                                              ${record.weight} lbs √ó ${record.reps} reps
                                                                                          </div>
                                                                                                    </div>
                                                                                                            `).join('');
                    }
            }

            function showScreen(screenName) {
                    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                    const screenMap = {
                              'home': 'home-screen',
                              'progress': 'progress-screen',
                              'settings': 'settings-screen',
                              'onboarding': 'onboarding-screen'
                    };
                    document.getElementById(screenMap[screenName]).classList.add('active');
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    if (screenName !== 'onboarding') {
                              event.target.closest('.nav-item')?.classList.add('active');
                    }
                    if (screenName === 'progress') {
                              updateProgressScreen();
                    }
            }

            function showOnboarding() {
                    document.getElementById('onboarding-screen').classList.add('active');
                    document.querySelectorAll('.screen').forEach(s => {
                              if (s.id !== 'onboarding-screen') s.classList.remove('active');
                    });
            }

            function exportData() {
                    const data = {
                              profile: getStorage(STORAGE_KEYS.USER_PROFILE),
                              split: getStorage(STORAGE_KEYS.WORKOUT_SPLIT),
                              history: getStorage(STORAGE_KEYS.WORKOUT_HISTORY),
                              prs: getStorage(STORAGE_KEYS.PERSONAL_RECORDS)
                    };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `fitness-data-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
            }

            function resetApp() {
                    if (!confirm('This will delete ALL your data. Are you sure?')) return;
                    if (!confirm('Really sure? This cannot be undone.')) return;
                    Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
                    location.reload();
            }

            if ('serviceWorker' in navigator) {
                    window.addEventListener('load', () => {
                              navigator.serviceWorker.register('sw.js').catch(() => {
                                          console.log('Service worker registration failed');
                              });
                    });
            }
              </script>
  </body>
</html>html>
      </script>
        </div>
        </div></strong></label></label></h3></h1>
  </body>
    </style></title>
  </head>
